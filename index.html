<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CTF Challenge Arena</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #1a202c;
      color: #e2e8f0;
      font-family: 'Arial', sans-serif;
    }
    .challenge-card {
      transition: all 0.3s ease;
    }
    .challenge-card:hover {
      transform: scale(1.02);
    }
    .solved-card {
      border: 2px solid #48bb78;
      opacity: 0.8;
    }
    .hidden-flag {
      display: none;
    }
    /* Hidden flags for challenges */
    #hidden-flag-1 { content: "flag{hidden_in_source}"; }
    #hidden-flag-4 { content: "flag{css_secret_flag}"; }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal-content {
      background-color: #2d3748;
      padding: 20px;
      border-radius: 8px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
  <div class="w-full max-w-5xl">
    <h1 class="text-4xl font-bold text-center mb-8 text-blue-400">CTF Challenge Arena</h1>
    <p class="text-center mb-6">Solve each challenge to unlock the next. Enter flags in the format <code>flag{example}</code>.</p>
    <div id="challenges" class="space-y-6"></div>
  </div>

  <!-- Modal for hints, instructions, and confirmations -->
  <div id="hint-modal" class="modal">
    <div class="modal-content">
      <h2 id="modal-title" class="text-2xl font-semibold text-blue-300 mb-4"></h2>
      <div id="modal-content" class="mb-4"></div>
      <button onclick="closeModal()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded">Close</button>
    </div>
  </div>

  <script>
    // Challenge data
    const challenges = [
      // Easy Challenges (1-10)
      {
        id: 1,
        title: "Hidden Treasure (Easy)",
        description: "The flag is hidden in the page's source code. Can you find it?",
        hint: "View the HTML source (Ctrl+U or right-click > View Source).",
        instructions: [
          "Open the browser's developer tools (F12 or right-click > View Page Source).",
          "Search for the <style> tag in the HTML.",
          "Look for a CSS rule with #hidden-flag-1.",
          "The content property contains the flag in the format flag{...}."
        ],
        flag: "flag{hidden_in_source}",
        validator: flag => flag === "flag{hidden_in_source}"
      },
      {
        id: 2,
        title: "Query Quest (Easy)",
        description: "The flag is passed in the URL as a query parameter. Try modifying the URL.",
        hint: "Append ?flag=... to the URL bar.",
        instructions: [
          "Look at the browser's URL bar.",
          "Append ?flag= followed by the flag in the format flag{...} to the URL.",
          "Press Enter to load the URL.",
          "Enter the flag from the query parameter into the input field."
        ],
        flag: "flag{query_param_flag}",
        validator: flag => {
          const params = new URLSearchParams(window.location.search);
          return params.get('flag') === "flag{query_param_flag}" && flag === "flag{query_param_flag}";
        }
      },
      {
        id: 3,
        title: "Cookie Crumble (Easy)",
        description: "A flag is stored in a browser cookie. Can you find it?",
        hint: "Check the browser's developer tools (F12 > Application > Cookies).",
        instructions: [
          "Open developer tools (F12).",
          "Go to the 'Application' tab.",
          "Expand 'Cookies' and select the site URL.",
          "Find the cookie named 'flag'.",
          "The cookie value is the flag in the format flag{...}."
        ],
        flag: "flag{cookie_monster}",
        validator: flag => {
          document.cookie = "flag=flag{cookie_monster}; path=/";
          return flag === "flag{cookie_monster}";
        }
      },
      {
        id: 4,
        title: "CSS Secret (Easy)",
        description: "The flag is hidden in the CSS styles. Can you locate it?",
        hint: "Inspect the page's styles or check the CSS in the <style> tag.",
        instructions: [
          "Open developer tools (F12) and go to the 'Sources' or 'Elements' tab.",
          "Find the <style> tag in the HTML head.",
          "Look for a rule with #hidden-flag-4.",
          "The content property contains the flag in the format flag{...}."
        ],
        flag: "flag{css_secret_flag}",
        validator: flag => flag === "flag{css_secret_flag}"
      },
      {
        id: 5,
        title: "Base64 Beginner (Easy)",
        description: "Decode this Base64 string: ZmxhZ3tiYXNlNjRfZWFzeX0=",
        hint: "Use a Base64 decoder or atob() in the console.",
        instructions: [
          "Copy the Base64 string.",
          "Open the browser console (F12 > Console).",
          "Use atob() to decode the string.",
          "The decoded string is the flag in the format flag{...}."
        ],
        flag: "flag{base64_easy}",
        validator: flag => atob("ZmxhZ3tiYXNlNjRfZWFzeX0=") === flag
      },
      {
        id: 6,
        title: "Comment Crawler (Easy)",
        description: "The flag is hidden in an HTML comment. Can you find it?",
        hint: "Look for <!-- comments --> in the HTML source.",
        instructions: [
          "View the page source (Ctrl+U or right-click > View Source).",
          "Search for HTML comments (<!-- ... -->).",
          "The comment contains the flag in the format flag{...}."
        ],
        flag: "flag{comment_flag}",
        validator: flag => flag === "flag{comment_flag}"
      },
      {
        id: 7,
        title: "Image Metadata (Easy)",
        description: "The flag is in the metadata of an imaginary image. Pretend you found: 'Author: flag{image_meta}'.",
        hint: "Check the 'Author' field in the metadata.",
        instructions: [
          "Imagine inspecting an image's metadata (e.g., right-click > Properties > Details).",
          "Look for the 'Author' field.",
          "The value is the flag in the format flag{...}."
        ],
        flag: "flag{image_meta}",
        validator: flag => flag === "flag{image_meta}"
      },
      {
        id: 8,
        title: "Simple XOR (Easy)",
        description: "Decrypt this XOR-encrypted flag: 4b4c4147 (key: 42).",
        hint: "Convert hex to bytes and XOR with key 42.",
        instructions: [
          "Convert the hex string to bytes.",
          "XOR each byte with 42 (0x2A).",
          "Convert the result to text to get the flag in the format flag{...}."
        ],
        flag: "flag{easy_xor}",
        validator: flag => {
          const encrypted = "4b4c4147";
          const key = 42;
          let decrypted = "";
          for (let i = 0; i < encrypted.length; i += 2) {
            const byte = parseInt(encrypted.slice(i, i + 2), 16);
            decrypted += String.fromCharCode(byte ^ key);
          }
          return decrypted === flag;
        }
      },
      {
        id: 9,
        title: "Hidden Input (Easy)",
        description: "The flag is in a hidden input field. Inspect the page to find it.",
        hint: "Look for <input type='hidden'> in the HTML.",
        instructions: [
          "Open developer tools (F12 > Elements).",
          "Search for <input type='hidden'> elements.",
          "The value attribute contains the flag in the format flag{...}."
        ],
        flag: "flag{hidden_input}",
        validator: flag => flag === "flag{hidden_input}"
      },
      {
        id: 10,
        title: "Console Clue (Easy)",
        description: "Open the console to find the flag in a console.log message.",
        hint: "Press F12 and check the Console tab.",
        instructions: [
          "Open developer tools (F12 > Console).",
          "Look for a console.log message.",
          "The message contains the flag in the format flag{...}."
        ],
        flag: "flag{console_flag}",
        validator: flag => {
          console.log("flag{console_flag}");
          return flag === "flag{console_flag}";
        }
      },
      // Beginner Challenges (11-20)
      {
        id: 11,
        title: "JavaScript Variable (Beginner)",
        description: "Find the flag in a JavaScript variable: var secret = 'flag{js_secret}';",
        hint: "Check the page's JavaScript code.",
        instructions: [
          "Open developer tools (F12 > Sources).",
          "Find the <script> tag or JavaScript code.",
          "Look for a variable named 'secret'.",
          "The variable's value is the flag in the format flag{...}."
        ],
        flag: "flag{js_secret}",
        validator: flag => flag === "flag{js_secret}"
      },
      {
        id: 12,
        title: "URL Encoding (Beginner)",
        description: "Decode this URL-encoded string: flagSDqflag%7Burl_encoded%7D",
        hint: "Use a URL decoder or decodeURIComponent() in the console.",
        instructions: [
          "Copy the URL-encoded string.",
          "Open the console (F12 > Console).",
          "Use decodeURIComponent('SDqflag%7Burl_encoded%7D').",
          "The decoded string is the flag in the format flag{...}."
        ],
        flag: "flag{url_encoded}",
        validator: flag => decodeURIComponent("SDqflag%7Burl_encoded%7D") === flag
      },
      {
        id: 13,
        title: "Simple Substitution (Beginner)",
        description: "Decode this substitution cipher: emfi{dfghjk}. (a->f, b->l, c->a, ...)",
        hint: "Map each letter to its corresponding letter in the alphabet.",
        instructions: [
          "Write down the cipher: emfi{dfghjk}.",
          "Use the substitution mapping (e.g., a->f, b->l, etc.).",
          "Replace each letter with its mapped letter.",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{sub_cipher}",
        validator: flag => {
          const cipher = "emfi{dfghjk}";
          const map = { e: 'f', m: 'l', f: 'a', i: 'g', d: '{', g: 's', h: 'u', j: 'b', k: '}'};
          let decrypted = "";
          for (let c of cipher) decrypted += map[c] || c;
          return decrypted === flag;
        }
      },
      {
        id: 14,
        title: "Fake Login (Beginner)",
        description: "Simulate a login bypass by entering 'admin' as the flag.",
        hint: "Try entering 'admin' in the input field.",
        instructions: [
          "Read the challenge description.",
          "Enter the username 'admin' in the input field.",
          "Submit to reveal the flag in the format flag{...}."
        ],
        flag: "flag{admin_bypass}",
        validator: flag => flag === "admin" ? "flag{admin_bypass}" : false
      },
      {
        id: 15,
        title: "Hex Decoder (Beginner)",
        description: "Decode this hex string: 666c61677b6865785f656173797d",
        hint: "Convert hex to ASCII using a tool or script.",
        instructions: [
          "Copy the hex string.",
          "Convert it to ASCII (e.g., use an online hex-to-ASCII converter).",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{hex_easy}",
        validator: flag => {
          let hex = "666c61677b6865785f656173797d";
          let decoded = "";
          for (let i = 0; i < hex.length; i += 2) {
            decoded += String.fromCharCode(parseInt(hex.slice(i, i + 2), 16));
          }
          return decoded === flag;
        }
      },
      {
        id: 16,
        title: "robots.txt (Beginner)",
        description: "The flag is in a simulated robots.txt file: User-agent: * Disallow: /flag{robots_flag}",
        hint: "Check the 'Disallow' entry in the description.",
        instructions: [
          "Read the simulated robots.txt content in the description.",
          "Look for the Disallow entry.",
          "The entry contains the flag in the format flag{...}."
        ],
        flag: "flag{robots_flag}",
        validator: flag => flag === "flag{robots_flag}"
      },
      {
        id: 17,
        title: "Broken Image (Beginner)",
        description: "The flag is in the alt text of a broken image: <img src='broken.jpg' alt='flag{alt_flag}'>",
        hint: "Inspect the HTML for the image's alt attribute.",
        instructions: [
          "Open developer tools (F12 > Elements).",
          "Find the <img> tag in the HTML.",
          "Check the alt attribute.",
          "The alt text is the flag in the format flag{...}."
        ],
        flag: "flag{alt_flag}",
        validator: flag => flag === "flag{alt_flag}"
      },
      {
        id: 18,
        title: "Caesar Cipher (Beginner)",
        description: "Decode this Caesar cipher: kodi{esppsl}. Shift: 3.",
        hint: "Shift each letter back by 3 positions in the alphabet.",
        instructions: [
          "Write down the cipher: kodi{esppsl}.",
          "Shift each letter back by 3 (e.g., k -> h, o -> l).",
          "Keep the braces { and } unchanged.",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{beginner}",
        validator: flag => {
          const cipher = "kodi{esppsl}";
          let decrypted = "";
          for (let c of cipher) {
            if (/[a-z]/.test(c)) {
              let code = c.charCodeAt(0) - 3;
              if (code < 97) code += 26;
              decrypted += String.fromCharCode(code);
            } else {
              decrypted += c;
            }
          }
          return decrypted === flag;
        }
      },
      {
        id: 19,
        title: "JSON Parser (Beginner)",
        description: "Extract the flag from this JSON: {'flag': 'flag{json_flag}'}",
        hint: "Look at the 'flag' key in the JSON.",
        instructions: [
          "Examine the JSON object in the description.",
          "Find the value of the 'flag' key.",
          "The value is the flag in the format flag{...}."
        ],
        flag: "flag{json_flag}",
        validator: flag => flag === "flag{json_flag}"
      },
      {
        id: 20,
        title: "Local Storage (Beginner)",
        description: "The flag is stored in localStorage under the key 'flag'.",
        hint: "Check localStorage in the console (localStorage.getItem('flag')).",
        instructions: [
          "Open the console (F12 > Console).",
          "Type localStorage.getItem('flag').",
          "The returned value is the flag in the format flag{...}."
        ],
        flag: "flag{local_storage}",
        validator: flag => {
          localStorage.setItem('flag', 'flag{local_storage}');
          return flag === "flag{local_storage}";
        }
      },
      // Medium Challenges (21-30)
      {
        id: 21,
        title: "SQL Injection (Medium)",
        description: "Simulate a SQL injection by entering ' OR '1'='1 in the input.",
        hint: "Enter ' OR '1'='1 to bypass authentication.",
        instructions: [
          "In the input field, type exactly: ' OR '1'='1 (including single quotes).",
          "Submit the input.",
          "The system will return the flag in the format flag{...}."
        ],
        flag: "flag{sql_injection_win}",
        validator: flag => flag === "' OR '1'='1" ? "flag{sql_injection_win}" : false
      },
      {
        id: 22,
        title: "Base64 Double (Medium)",
        description: "Decode this Base64 string twice: WjB4e2ZpcnN0X2xheWVyfQ==",
        hint: "Decode the Base64 string, then decode the result again.",
        instructions: [
          "Copy the Base64 string.",
          "Decode it using atob() or a Base64 decoder.",
          "Take the result and decode it again.",
          "The final result is the flag in the format flag{...}."
        ],
        flag: "flag{double_base64}",
        validator: flag => atob(atob("WjB4e2ZpcnN0X2xheWVyfQ==")) === flag
      },
      {
        id: 23,
        title: "XOR Cipher (Medium)",
        description: "Decrypt this XOR-encrypted flag: 1a0f1c0b1e1c0a1f (key: 42).",
        hint: "Convert hex to bytes, XOR each byte with key 42.",
        instructions: [
          "Convert the hex string to bytes (e.g., [0x1a, 0x0f, ...]).",
          "XOR each byte with the key 42 (0x2A).",
          "Convert the result to text to get the flag in the format flag{...}."
        ],
        flag: "flag{xor_decrypted}",
        validator: flag => {
          const encrypted = "1a0f1c0b1e1c0a1f";
          const key = 42;
          let decrypted = "";
          for (let i = 0; i < encrypted.length; i += 2) {
            const byte = parseInt(encrypted.slice(i, i + 2), 16);
            decrypted += String.fromCharCode(byte ^ key);
          }
          return decrypted === flag;
        }
      },
      {
        id: 24,
        title: "Steganography (Medium)",
        description: "The flag is hidden in an imaginary image's least significant bits: 666c61677b73746567616e6f7d",
        hint: "Extract the hex string and convert to ASCII.",
        instructions: [
          "Copy the hex string from the description.",
          "Convert it to ASCII using a tool or script.",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{stegano}",
        validator: flag => {
          let hex = "666c61677b73746567616e6f7d";
          let decoded = "";
          for (let i = 0; i < hex.length; i += 2) {
            decoded += String.fromCharCode(parseInt(hex.slice(i, i + 2), 16));
          }
          return decoded === flag;
        }
      },
      {
        id: 25,
        title: "Regex Bypass (Medium)",
        description: "Bypass a regex filter by entering flag{regex_bypass} with extra characters.",
        hint: "Enter the flag with extra characters like flag{regex_bypass}123.",
        instructions: [
          "Read the description for the flag format.",
          "Add any extra characters to the flag (e.g., numbers or symbols).",
          "Submit the modified flag.",
          "The system extracts the flag in the format flag{...}."
        ],
        flag: "flag{regex_bypass}",
        validator: flag => flag.match(/flag\{regex_bypass\}/) ? "flag{regex_bypass}" : false
      },
      {
        id: 26,
        title: "Vigenere Cipher (Medium)",
        description: "Decrypt this Vigenere cipher: kngf{ftuvwx} (key: secret).",
        hint: "Use the Vigenere cipher decryption with key 'secret'.",
        instructions: [
          "Write down the cipher: kngf{ftuvwx}.",
          "Use the key 'secret' to decrypt (shift each letter by the corresponding key letter).",
          "Keep the braces { and } unchanged.",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{vigenere}",
        validator: flag => {
          const cipher = "kngf{ftuvwx}";
          const key = "secret";
          let decrypted = "";
          let keyIndex = 0;
          for (let c of cipher) {
            if (/[a-z]/.test(c)) {
              let shift = key.charCodeAt(keyIndex % key.length) - 97;
              let code = c.charCodeAt(0) - shift;
              if (code < 97) code += 26;
              decrypted += String.fromCharCode(code);
              keyIndex++;
            } else {
              decrypted += c;
            }
          }
          return decrypted === flag;
        }
      },
      {
        id: 27,
        title: "HTTP Header (Medium)",
        description: "The flag is in a simulated HTTP header: X-Flag: flag{http_header}",
        hint: "Check the 'X-Flag' header in the description.",
        instructions: [
          "Read the simulated HTTP header in the description.",
          "Find the 'X-Flag' header.",
          "The header value is the flag in the format flag{...}."
        ],
        flag: "flag{http_header}",
        validator: flag => flag === "flag{http_header}"
      },
      {
        id: 28,
        title: "MD5 Hash (Medium)",
        description: "Find the string that produces this MD5 hash: 8f6d76f3f4b6e8b6a5d6f7e2a1b3c4d5",
        hint: "The input is flag{md5_hash}. Try hashing it.",
        instructions: [
          "Copy the MD5 hash from the description.",
          "Use an MD5 hashing tool or script.",
          "Hash the string flag{md5_hash}.",
          "Verify it matches the given hash to confirm the flag."
        ],
        flag: "flag{md5_hash}",
        validator: flag => {
          const md5 = str => {
            // Simplified MD5 simulation for client-side
            return flag === "flag{md5_hash}" ? "8f6d76f3f4b6e8b6a5d6f7e2a1b3c4d5" : "";
          };
          return md5(flag) === "8f6d76f3f4b6e8b6a5d6f7e2a1b3c4d5";
        }
      },
      {
        id: 29,
        title: "Packet Analysis (Medium)",
        description: "Analyze this JSON 'packet': {'data': 'flag_packet', 'protocol': 'TCP'}",
        hint: "Extract the 'data' field and format it as a flag.",
        instructions: [
          "Examine the JSON object in the description.",
          "Find the 'data' field.",
          "Format the value as a flag in the format flag{...}.",
          "Enter the formatted flag."
        ],
        flag: "flag{packet}",
        validator: flag => flag === "flag{packet}"
      },
      {
        id: 30,
        title: "Morse Code (Medium)",
        description: "Decode this Morse code: ..-. .-.. .- --. / -... .-. .- -.-. -.- . -",
        hint: "Use a Morse code decoder or chart.",
        instructions: [
          "Copy the Morse code: ..-. .-.. .- --. / -... .-. .- -.-. -.- . -",
          "Use a Morse code chart (e.g., F=..-. , L=.-.. , etc.).",
          "Decode each part and combine, keeping the braces.",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{bracket}",
        validator: flag => {
          const morse = { "....": "H", ".-": "A", "..-.": "F", ".-..": "L", ".-.": "R", "-...": "B", ".- -.-.": "C", "-.-": "K", ".": "E", "-": "T" };
          let parts = "..-. .-.. .- --. / -... .-. .- -.-. -.- . -".split(" / ");
          let decoded = "";
          for (let part of parts) {
            decoded += morse[part] || "";
          }
          decoded = `flag{${decoded.slice(0, 4).toLowerCase()}${decoded.slice(4).toLowerCase()}}`;
          return decoded === flag;
        }
      },
      // Hard Challenges (31-40)
      {
        id: 31,
        title: "JavaScript Obfuscation (Hard)",
        description: "Deobfuscate: eval(function(p,a,c,k,e,d){while(c--)if(k[c])p=p.replace(new RegExp('\\b'+c+'\\b','g'),k[c]);return p}('0{1}',2,2,'flag|obfuscated_flag'.split('|'),0,{}))",
        hint: "Run the eval code in the console or deobfuscate manually.",
        instructions: [
          "Copy the eval function to the console (F12 > Console).",
          "Execute it to see the output.",
          "Analyze the function: it replaces 0 with 'flag' and 1 with another string.",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{obfuscated_flag}",
        validator: flag => flag === "flag{obfuscated_flag}"
      },
      {
        id: 32,
        title: "RSA Decryption (Hard)",
        description: "Decrypt RSA: c=123456789, n=123457, e=65537. (Private key provided for simulation: d=123).",
        hint: "Use the private key to decrypt c^d mod n.",
        instructions: [
          "Use the RSA formula: m = c^d mod n.",
          "Compute 123456789^123 mod 123457.",
          "Convert the result to ASCII.",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{rsa_decrypt}",
        validator: flag => flag === "flag{rsa_decrypt}"
      },
      {
        id: 33,
        title: "Format String (Hard)",
        description: "Exploit a format string vulnerability by entering %x%x%xflag{format_string}.",
        hint: "Use the format string to reveal the flag.",
        instructions: [
          "Enter the format string %x%x%xflag{format_string}.",
          "The system simulates a format string exploit.",
          "The output is the flag in the format flag{...}."
        ],
        flag: "flag{format_string}",
        validator: flag => flag === "%x%x%xflag{format_string}" ? "flag{format_string}" : false
      },
      {
        id: 34,
        title: "Packet Sniffing (Hard)",
        description: "Analyze this packet capture: {'src': '192.168.1.1', 'data': 'flag_sniff'}",
        hint: "Extract the 'data' field and format it.",
        instructions: [
          "Examine the JSON packet in the description.",
          "Find the 'data' field.",
          "Format the value as a flag in the format flag{...}.",
          "Enter the formatted flag."
        ],
        flag: "flag{sniff}",
        validator: flag => flag === "flag{sniff}"
      },
      {
        id: 35,
        title: "Binary Analysis (Hard)",
        description: "Analyze this binary snippet: mov eax, 'flag'; mov ebx, '{binary}';",
        hint: "Extract the flag from the assembly code.",
        instructions: [
          "Read the assembly code in the description.",
          "Note the values moved into eax and ebx.",
          "Combine them to form the flag in the format flag{...}."
        ],
        flag: "flag{binary}",
        validator: flag => flag === "flag{binary}"
      },
      {
        id: 36,
        title: "Stego Deep (Hard)",
        description: "Extract from image pixels: 666c61677b737465676f5f686172647d",
        hint: "Convert the hex string to ASCII.",
        instructions: [
          "Copy the hex string from the description.",
          "Convert it to ASCII using a tool or script.",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{stego_hard}",
        validator: flag => {
          let hex = "666c61677b737465676f5f686172647d";
          let decoded = "";
          for (let i = 0; i < hex.length; i += 2) {
            decoded += String.fromCharCode(parseInt(hex.slice(i, i + 2), 16));
          }
          return decoded === flag;
        }
      },
      {
        id: 37,
        title: "SQL Advanced (Hard)",
        description: "Bypass with: admin' --",
        hint: "Use a SQL comment to bypass authentication.",
        instructions: [
          "Enter admin' -- in the input field.",
          "The -- comments out the rest of the query.",
          "Submit to reveal the flag in the format flag{...}."
        ],
        flag: "flag{sql_advanced}",
        validator: flag => flag === "admin' --" ? "flag{sql_advanced}" : false
      },
      {
        id: 38,
        title: "AES Decryption (Hard)",
        description: "Decrypt AES: ciphertext=abcdef1234567890, key=1234567890abcdef",
        hint: "Use the key to decrypt the ciphertext.",
        instructions: [
          "Copy the ciphertext and key.",
          "Use an AES decryption tool with the provided key.",
          "The decrypted text is the flag in the format flag{...}."
        ],
        flag: "flag{aes_decrypt}",
        validator: flag => flag === "flag{aes_decrypt}"
      },
      {
        id: 39,
        title: "JWT Forgery (Hard)",
        description: "Forge a JWT with payload: {'user': 'flag{jwt_forge}'}",
        hint: "Extract the payload from the JWT.",
        instructions: [
          "Read the JWT payload in the description.",
          "Extract the 'user' field value.",
          "The value is the flag in the format flag{...}."
        ],
        flag: "flag{jwt_forge}",
        validator: flag => flag === "flag{jwt_forge}"
      },
      {
        id: 40,
        title: "Shellcode (Hard)",
        description: "Analyze shellcode: push 'flag'; push '{shellcode}';",
        hint: "Extract the flag from the shellcode.",
        instructions: [
          "Read the shellcode in the description.",
          "Note the values pushed onto the stack.",
          "Combine them to form the flag in the format flag{...}."
        ],
        flag: "flag{shellcode}",
        validator: flag => flag === "flag{shellcode}"
      },
      // Expert Challenges (41-50) - Multi-Step
      {
        id: 41,
        title: "Multi-Step Crypto (Expert)",
        description: "Step 1: Decode Base64: ZmxhZw==. Step 2: XOR result with key 42. Step 3: Format as flag{...}.",
        hint: "Follow the steps in order: Base64 decode, XOR, format.",
        instructions: [
          "Decode the Base64 string ZmxhZw== using atob().",
          "XOR each byte of the result with 42.",
          "Convert the result to ASCII.",
          "Format the result as flag{...}."
        ],
        flag: "flag{crypto_multi}",
        validator: flag => {
          let decoded = atob("ZmxhZw==");
          let xored = "";
          for (let c of decoded) {
            xored += String.fromCharCode(c.charCodeAt(0) ^ 42);
          }
          return `flag{${xored}}` === flag;
        }
      },
      {
        id: 42,
        title: "Reverse Multi (Expert)",
        description: "Step 1: Deobfuscate JS: (function(){return 'Zm';})(). Step 2: Decode Base64. Step 3: Format.",
        hint: "Execute the JS, decode the result, and format.",
        instructions: [
          "Copy the JavaScript code to the console.",
          "Execute to get a Base64 string.",
          "Decode the Base64 string using atob().",
          "Format the result as flag{...}."
        ],
        flag: "flag{reverse_multi}",
        validator: flag => atob((function(){return 'ZmxhZ3tyZXZlcnNlX211bHRpfQ==';})()) === flag
      },
      {
        id: 43,
        title: "Forensic Packet (Expert)",
        description: "Step 1: Extract 'data' from {'data': '666c6167', 'key': '42'}. Step 2: Hex to ASCII. Step 3: XOR with key. Step 4: Format.",
        hint: "Extract data, convert, XOR, and format.",
        instructions: [
          "Extract the 'data' field from the JSON.",
          "Convert the hex string to ASCII.",
          "XOR each byte with the key (42).",
          "Format the result as flag{...}."
        ],
        flag: "flag{forensic_packet}",
        validator: flag => {
          let hex = "666c6167";
          let decoded = "";
          for (let i = 0; i < hex.length; i += 2) {
            decoded += String.fromCharCode(parseInt(hex.slice(i, i + 2), 16));
          }
          let xored = "";
          for (let c of decoded) {
            xored += String.fromCharCode(c.charCodeAt(0) ^ 42);
          }
          return `flag{${xored}}` === flag;
        }
      },
      {
        id: 44,
        title: "Buffer Overflow (Expert)",
        description: "Step 1: Simulate overflow with input: AAAAflag{buffer_overflow}. Step 2: Extract flag.",
        hint: "Enter the input and extract the flag part.",
        instructions: [
          "Enter the input string as provided.",
          "Extract the portion matching flag{...}.",
          "Submit the extracted flag."
        ],
        flag: "flag{buffer_overflow}",
        validator: flag => flag === "flag{buffer_overflow}" && flag.match(/AAAAflag\{buffer_overflow\}/)
      },
      {
        id: 45,
        title: "Stego Multi (Expert)",
        description: "Step 1: Extract hex from image: 666c6167. Step 2: Convert to ASCII. Step 3: Append '_stego' and format.",
        hint: "Convert hex, append text, and format.",
        instructions: [
          "Copy the hex string from the description.",
          "Convert it to ASCII.",
          "Append '_stego' to the result.",
          "Format as flag{...}."
        ],
        flag: "flag{flag_stego}",
        validator: flag => {
          let hex = "666c6167";
          let decoded = "";
          for (let i = 0; i < hex.length; i += 2) {
            decoded += String.fromCharCode(parseInt(hex.slice(i, i + 2), 16));
          }
          return `flag{${decoded}_stego}` === flag;
        }
      },
      {
        id: 46,
        title: "SQL Multi (Expert)",
        description: "Step 1: Inject ' OR 1=1 --. Step 2: Extract flag from result: flag_sql. Step 3: Format.",
        hint: "Inject SQL, extract, and format.",
        instructions: [
          "Enter ' OR 1=1 -- in the input field.",
          "Extract the flag_sql from the simulated output.",
          "Format as flag{...}."
        ],
        flag: "flag{flag_sql}",
        validator: flag => flag === "' OR 1=1 --" ? "flag{flag_sql}" : false
      },
      {
        id: 47,
        title: "Crypto Chain (Expert)",
        description: "Step 1: Decode Base64: YmFzZQ==. Step 2: Caesar shift 5. Step 3: Format.",
        hint: "Decode Base64, apply Caesar cipher, and format.",
        instructions: [
          "Decode the Base64 string YmFzZQ==.",
          "Apply a Caesar cipher shift of 5 to the result.",
          "Format the result as flag{...}."
        ],
        flag: "flag{chain}",
        validator: flag => {
          let decoded = atob("YmFzZQ==");
          let shifted = "";
          for (let c of decoded) {
            let code = c.charCodeAt(0) + 5;
            if (code > 122) code -= 26;
            shifted += String.fromCharCode(code);
          }
          return `flag{${shifted}}` === flag;
        }
      },
      {
        id: 48,
        title: "Reverse Complex (Expert)",
        description: "Step 1: Deobfuscate: (function(){var x='ZmxhZw==';return atob(x);})(). Step 2: XOR with 42. Step 3: Format.",
        hint: "Execute JS, XOR result, and format.",
        instructions: [
          "Execute the JavaScript in the console to get a Base64 string.",
          "Decode the Base64 string.",
          "XOR each byte with 42.",
          "Format the result as flag{...}."
        ],
        flag: "flag{complex_reverse}",
        validator: flag => {
          let decoded = atob((function(){var x='ZmxhZw==';return atob(x);})());
          let xored = "";
          for (let c of decoded) {
            xored += String.fromCharCode(c.charCodeAt(0) ^ 42);
          }
          return `flag{${xored}}` === flag;
        }
      },
      {
        id: 49,
        title: "Network Deep (Expert)",
        description: "Step 1: Analyze packet: {'data': 'Zm', 'key': '42'}. Step 2: Base64 decode. Step 3: XOR with key. Step 4: Format.",
        hint: "Decode data, XOR with key, and format.",
        instructions: [
          "Extract the 'data' field from the JSON.",
          "Decode the Base64 string.",
          "XOR each byte with the key (42).",
          "Format the result as flag{...}."
        ],
        flag: "flag{network_deep}",
        validator: flag => {
          let decoded = atob("Zm");
          let xored = "";
          for (let c of decoded) {
            xored += String.fromCharCode(c.charCodeAt(0) ^ 42);
          }
          return `flag{${xored}}` === flag;
        }
      },
      {
        id: 50,
        title: "Ultimate Challenge (Expert)",
        description: "Step 1: Decode Base64: ZmxhZw==. Step 2: Reverse string. Step 3: XOR with 42. Step 4: Append '_ultimate'. Step 5: Format.",
        hint: "Decode, reverse, XOR, append, and format.",
        instructions: [
          "Decode the Base64 string ZmxhZw==.",
          "Reverse the decoded string.",
          "XOR each byte with 42.",
          "Append '_ultimate' to the result.",
          "Format as flag{...}."
        ],
        flag: "flag{galf_ultimate}",
        validator: flag => {
          let decoded = atob("ZmxhZw==");
          let reversed = decoded.split("").reverse().join("");
          let xored = "";
          for (let c of reversed) {
            xored += String.fromCharCode(c.charCodeAt(0) ^ 42);
          }
          return `flag{${xored}_ultimate}` === flag;
        }
      }
    ];

    // State management
    let solvedChallenges = JSON.parse(localStorage.getItem('solvedChallenges')) || [];
    let incorrectAttempts = {};

    // Render challenges
    function renderChallenges() {
      const challengesDiv = document.getElementById('challenges');
      challengesDiv.innerHTML = '';
      challenges.forEach(challenge => {
        const isUnlocked = challenge.id === 1 || solvedChallenges.includes(challenge.id - 1);
        const isSolved = solvedChallenges.includes(challenge.id);
        const card = document.createElement('div');
        card.className = `challenge-card bg-gray-800 p-6 rounded-lg shadow-lg ${isUnlocked ? '' : 'opacity-50 cursor-not-allowed'} ${isSolved ? 'solved-card' : ''}`;
        card.innerHTML = `
          <h2 class="text-2xl font-semibold text-blue-300">${challenge.title}</h2>
          <p class="mt-2">${challenge.description}</p>
          ${isUnlocked ? `
            ${isSolved ? '<p class="mt-2 text-green-400 font-bold">Solved!</p>' : `
              <p class="mt-2 text-blue-400 cursor-pointer underline" onclick="showHint('${challenge.hint}')">Show Hint</p>
              <input id="flag-${challenge.id}" type="text" placeholder="Enter flag (flag{...})" class="mt-4 w-full p-2 bg-gray-700 text-white rounded" ${isSolved ? 'disabled' : ''}>
              <button onclick="submitFlag(${challenge.id})" class="mt-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded" ${isSolved ? 'disabled' : ''}>Submit</button>
              <p id="feedback-${challenge.id}" class="mt-2 text-sm"></p>
            `}
          ` : `<p class="mt-2 text-red-400">Solve Challenge ${challenge.id - 1} to unlock</p>`}
        `;
        challengesDiv.appendChild(card);
      });
    }

    // Show hint in modal
    function showHint(hint) {
      const modal = document.getElementById('hint-modal');
      const modalTitle = document.getElementById('modal-title');
      const modalContent = document.getElementById('modal-content');
      modalTitle.textContent = 'Hint';
      modalContent.textContent = hint;
      modal.style.display = 'flex';
    }

    // Show detailed instructions in modal
    function showInstructions(instructions) {
      const modal = document.getElementById('hint-modal');
      const modalTitle = document.getElementById('modal-title');
      const modalContent = document.getElementById('modal-content');
      modalTitle.textContent = 'Detailed Instructions';
      modalContent.innerHTML = '<ul class="list-disc pl-5">' + instructions.map(item => `<li>${item}</li>`).join('') + '</ul>';
      modal.style.display = 'flex';
    }

    // Show confirmation in modal
    function showConfirmation(message, isCorrect, instructions = null) {
      const modal = document.getElementById('hint-modal');
      const modalTitle = document.getElementById('modal-title');
      const modalContent = document.getElementById('modal-content');
      modalTitle.textContent = isCorrect ? 'Success!' : 'Incorrect Submission';
      modalContent.innerHTML = `<p class="${isCorrect ? 'text-green-400' : 'text-red-400'}">${message}</p>`;
      if (!isCorrect && instructions) {
        modalContent.innerHTML += '<p class="mt-4">Detailed Instructions:</p><ul class="list-disc pl-5">' + instructions.map(item => `<li>${item}</li>`).join('') + '</ul>';
      }
      modal.style.display = 'flex';
    }

    // Close modal
    function closeModal() {
      document.getElementById('hint-modal').style.display = 'none';
    }

    // Submit flag
    function submitFlag(challengeId) {
      const challenge = challenges.find(c => c.id === challengeId);
      const input = document.getElementById(`flag-${challengeId}`).value;
      if (challenge.validator(input)) {
        showConfirmation('Correct! Flag accepted.', true);
        if (!solvedChallenges.includes(challengeId)) {
          solvedChallenges.push(challengeId);
          localStorage.setItem('solvedChallenges', JSON.stringify(solvedChallenges));
          incorrectAttempts[challengeId] = 0; // Reset attempts on success
          renderChallenges();
        }
      } else {
        incorrectAttempts[challengeId] = (incorrectAttempts[challengeId] || 0) + 1;
        const message = 'Incorrect flag. Try again!';
        showConfirmation(message, false, incorrectAttempts[challengeId] >= 3 ? challenge.instructions : null);
      }
    }

    // Initialize
    renderChallenges();
  </script>
</body>
</html>
