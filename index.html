<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CTF Challenge Arena</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #1a202c;
      color: #e2e8f0;
      font-family: 'Arial', sans-serif;
    }
    .challenge-card {
      transition: all 0.3s ease;
    }
    .challenge-card:hover {
      transform: scale(1.02);
    }
    .solved-card {
      border: 2px solid #48bb78;
      opacity: 0.8;
    }
    .hidden-flag {
      display: none;
    }
    /* Hidden flag for Challenge 1 */
    #hidden-flag { content: "flag{hidden_in_source}"; }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal-content {
      background-color: #2d3748;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      width: 90%;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
  <div class="w-full max-w-4xl">
    <h1 class="text-4xl font-bold text-center mb-8 text-blue-400">CTF Challenge Arena</h1>
    <p class="text-center mb-6">Solve each challenge to unlock the next. Enter flags in the format <code>flag{example}</code>.</p>
    <div id="challenges" class="space-y-6"></div>
  </div>

  <!-- Modal for hints, instructions, and confirmations -->
  <div id="hint-modal" class="modal">
    <div class="modal-content">
      <h2 id="modal-title" class="text-2xl font-semibold text-blue-300 mb-4"></h2>
      <div id="modal-content" class="mb-4"></div>
      <button onclick="closeModal()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded">Close</button>
    </div>
  </div>

  <script>
    // Challenge data with hints and detailed instructions
    const challenges = [
      {
        id: 1,
        title: "Hidden Treasure (Easy)",
        description: "The flag is hidden somewhere in the page's source code. Can you find it?",
        hint: "View the HTML source (Ctrl+U or right-click > View Source).",
        instructions: [
          "Open the browser's developer tools (F12 or right-click > View Page Source).",
          "Search for the <style> tag in the HTML.",
          "Look for a CSS rule with #hidden-flag.",
          "The content property contains the flag in the format flag{...}."
        ],
        flag: "flag{hidden_in_source}",
        validator: flag => flag === "flag{hidden_in_source}"
      },
      {
        id: 2,
        title: "Query Quest (Easy)",
        description: "The flag is passed in the URL as a query parameter. Try modifying the URL.",
        hint: "Try visiting ?flag=flag{query_param_flag} in the URL bar.",
        instructions: [
          "Look at the browser's URL bar.",
          "Append ?flag= followed by the flag in the format flag{...} to the URL.",
          "Press Enter to load the URL.",
          "Enter the flag from the query parameter into the input field."
        ],
        flag: "flag{query_param_flag}",
        validator: flag => {
          const params = new URLSearchParams(window.location.search);
          return params.get('flag') === "flag{query_param_flag}" && flag === "flag{query_param_flag}";
        }
      },
      {
        id: 3,
        title: "Cookie Crumble (Beginner)",
        description: "A flag is stored in a browser cookie. Can you find it?",
        hint: "Check the browser's developer tools (F12 > Application > Cookies).",
        instructions: [
          "Open developer tools (F12).",
          "Go to the 'Application' tab.",
          "Expand 'Cookies' and select the site URL.",
          "Find the cookie named 'flag'.",
          "The cookie value is the flag in the format flag{...}."
        ],
        flag: "flag{cookie_monster}",
        validator: flag => {
          document.cookie = "flag=flag{cookie_monster}; path=/";
          return flag === "flag{cookie_monster}";
        }
      },
      {
        id: 4,
        title: "CSS Secret (Beginner)",
        description: "The flag is hidden in the CSS styles. Can you locate it?",
        hint: "Inspect the page's styles or check the CSS in the <style> tag.",
        instructions: [
          "Open developer tools (F12) and go to the 'Sources' or 'Elements' tab.",
          "Find the <style> tag in the HTML head.",
          "Look for a comment or rule containing the flag.",
          "The flag is in the format flag{...}."
        ],
        flag: "flag{css_secret_flag}",
        validator: flag => flag === "flag{css_secret_flag}"
      },
      {
        id: 5,
        title: "Base64 Puzzle (Medium)",
        description: "Decode this Base64 string to find the flag: ZmxhZ3tiYXNlNjRfZGVjb2RlfQ==",
        hint: "Use a Base64 decoder or the atob() function in the browser console.",
        instructions: [
          "Copy the Base64 string: ZmxhZ3tiYXNlNjRfZGVjb2RlfQ==.",
          "Open the browser console (F12 > Console).",
          "Use the atob() function to decode the string: atob('ZmxhZ3tiYXNlNjRfZGVjb2RlfQ==').",
          "The decoded string is the flag in the format flag{...}."
        ],
        flag: "flag{base64_decode}",
        validator: flag => atob("ZmxhZ3tiYXNlNjRfZGVjb2RlfQ==") === flag
      },
      {
        id: 6,
        title: "SQL Injection (Medium)",
        description: "Simulate a SQL injection to reveal the flag.",
        hint: "Enter ' OR '1'='1 in the input field to simulate SQL injection.",
        instructions: [
          "In the input field, type exactly: ' OR '1'='1 (including single quotes).",
          "Submit the input.",
          "The system will return the flag in the format flag{...}."
        ],
        flag: "flag{sql_injection_win}",
        validator: flag => flag === "' OR '1'='1" ? "flag{sql_injection_win}" : false
      },
      {
        id: 7,
        title: "XOR Cipher (Medium)",
        description: "Decrypt this XOR-encrypted flag: 1a0f1c0b1e1c0a1f (key: 42).",
        hint: "Convert hex to bytes, XOR each byte with the key 42 using a script.",
        instructions: [
          "Convert the hex string 1a0f1c0b1e1c0a1f to bytes (e.g., [0x1a, 0x0f, ...]).",
          "XOR each byte with the key 42 (0x2A).",
          "Use a script like: let hex = '1a0f1c0b1e1c0a1f'; let key = 42; let decrypted = ''; for (let i = 0; i < hex.length; i += 2) { decrypted += String.fromCharCode(parseInt(hex.slice(i, i+2), 16) ^ key); }.",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{xor_decrypted}",
        validator: flag => {
          const encrypted = "1a0f1c0b1e1c0a1f";
          const key = 42;
          let decrypted = "";
          for (let i = 0; i < encrypted.length; i += 2) {
            const byte = parseInt(encrypted.slice(i, i + 2), 16);
            decrypted += String.fromCharCode(byte ^ key);
          }
          return decrypted === flag;
        }
      },
      {
        id: 8,
        title: "JavaScript Obfuscation (Hard)",
        description: "Deobfuscate this JavaScript to find the flag: eval(function(p,a,c,k,e,d){while(c--)if(k[c])p=p.replace(new RegExp('\\b'+c+'\\b','g'),k[c]);return p}('0{1}',2,2,'flag|obfuscated_flag'.split('|'),0,{}))",
        hint: "Run the eval code in the console or deobfuscate it manually to reveal the flag.",
        instructions: [
          "Copy the eval function to the browser console (F12 > Console).",
          "Execute it to see the output.",
          "Alternatively, analyze the function: it replaces 0 with 'flag' and 1 with another string, forming the flag.",
          "The result is the flag in the format flag{...}."
        ],
        flag: "flag{obfuscated_flag}",
        validator: flag => flag === "flag{obfuscated_flag}"
      },
      {
        id: 9,
        title: "Network Packet (Hard)",
        description: "Analyze this JSON 'packet': {'data': 'flag_packet_flag', 'protocol': 'TCP', 'hidden': true}.",
        hint: "Extract the flag from the 'data' field of the JSON object.",
        instructions: [
          "Examine the JSON object provided in the description.",
          "Identify the 'data' field.",
          "Format the value as a flag in the format flag{...}.",
          "Enter the formatted flag in the input field."
        ],
        flag: "flag{packet_flag}",
        validator: flag => flag === "flag{packet_flag}"
      },
      {
        id: 10,
        title: "Reverse Engineering (Expert)",
        description: "Decode this obfuscated JS to find the flag: (function(){var _0x1234=['flag{reverse_engineered}'];return _0x1234[0];})().",
        hint: "Analyze the JavaScript in the browser console to extract the flag.",
        instructions: [
          "Copy the JavaScript to the browser console (F12 > Console).",
          "Execute it to reveal the output.",
          "Alternatively, inspect the code: it defines an array _0x1234 with one element.",
          "The array's first element is the flag in the format flag{...}."
        ],
        flag: "flag{reverse_engineered}",
        validator: flag => (function(){var _0x1234=['flag{reverse_engineered}'];return _0x1234[0];})() === flag
      }
    ];

    // State management
    let solvedChallenges = JSON.parse(localStorage.getItem('solvedChallenges')) || [];
    let incorrectAttempts = {};

    // Render challenges
    function renderChallenges() {
      const challengesDiv = document.getElementById('challenges');
      challengesDiv.innerHTML = '';
      challenges.forEach(challenge => {
        const isUnlocked = challenge.id === 1 || solvedChallenges.includes(challenge.id - 1);
        const isSolved = solvedChallenges.includes(challenge.id);
        const card = document.createElement('div');
        card.className = `challenge-card bg-gray-800 p-6 rounded-lg shadow-lg ${isUnlocked ? '' : 'opacity-50 cursor-not-allowed'} ${isSolved ? 'solved-card' : ''}`;
        card.innerHTML = `
          <h2 class="text-2xl font-semibold text-blue-300">${challenge.title}</h2>
          <p class="mt-2">${challenge.description}</p>
          ${isUnlocked ? `
            ${isSolved ? '<p class="mt-2 text-green-400 font-bold">Solved!</p>' : `
              <p class="mt-2 text-blue-400 cursor-pointer underline" onclick="showHint('${challenge.hint}')">Show Hint</p>
              <input id="flag-${challenge.id}" type="text" placeholder="Enter flag (flag{...})" class="mt-4 w-full p-2 bg-gray-700 text-white rounded" ${isSolved ? 'disabled' : ''}>
              <button onclick="submitFlag(${challenge.id})" class="mt-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded" ${isSolved ? 'disabled' : ''}>Submit</button>
              <p id="feedback-${challenge.id}" class="mt-2 text-sm"></p>
            `}
          ` : `<p class="mt-2 text-red-400">Solve Challenge ${challenge.id - 1} to unlock</p>`}
        `;
        challengesDiv.appendChild(card);
      });
    }

    // Show hint in modal
    function showHint(hint) {
      const modal = document.getElementById('hint-modal');
      const modalTitle = document.getElementById('modal-title');
      const modalContent = document.getElementById('modal-content');
      modalTitle.textContent = 'Hint';
      modalContent.textContent = hint;
      modal.style.display = 'flex';
    }

    // Show detailed instructions in modal
    function showInstructions(instructions) {
      const modal = document.getElementById('hint-modal');
      const modalTitle = document.getElementById('modal-title');
      const modalContent = document.getElementById('modal-content');
      modalTitle.textContent = 'Detailed Instructions';
      modalContent.innerHTML = '<ul class="list-disc pl-5">' + instructions.map(item => `<li>${item}</li>`).join('') + '</ul>';
      modal.style.display = 'flex';
    }

    // Show confirmation in modal
    function showConfirmation(message, isCorrect, instructions = null) {
      const modal = document.getElementById('hint-modal');
      const modalTitle = document.getElementById('modal-title');
      const modalContent = document.getElementById('modal-content');
      modalTitle.textContent = isCorrect ? 'Success!' : 'Incorrect Submission';
      modalContent.innerHTML = `<p class="${isCorrect ? 'text-green-400' : 'text-red-400'}">${message}</p>`;
      if (!isCorrect && instructions) {
        modalContent.innerHTML += '<p class="mt-4">Detailed Instructions:</p><ul class="list-disc pl-5">' + instructions.map(item => `<li>${item}</li>`).join('') + '</ul>';
      }
      modal.style.display = 'flex';
    }

    // Close modal
    function closeModal() {
      document.getElementById('hint-modal').style.display = 'none';
    }

    // Submit flag
    function submitFlag(challengeId) {
      const challenge = challenges.find(c => c.id === challengeId);
      const input = document.getElementById(`flag-${challengeId}`).value;
      if (challenge.validator(input)) {
        showConfirmation('Correct! Flag accepted.', true);
        if (!solvedChallenges.includes(challengeId)) {
          solvedChallenges.push(challengeId);
          localStorage.setItem('solvedChallenges', JSON.stringify(solvedChallenges));
          incorrectAttempts[challengeId] = 0; // Reset attempts on success
          renderChallenges();
        }
      } else {
        incorrectAttempts[challengeId] = (incorrectAttempts[challengeId] || 0) + 1;
        const message = 'Incorrect flag. Try again!';
        showConfirmation(message, false, incorrectAttempts[challengeId] >= 3 ? challenge.instructions : null);
      }
    }

    // Initialize
    renderChallenges();
  </script>
</body>
</html>
